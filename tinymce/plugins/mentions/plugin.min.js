/* Tiny mentions plugin
 *
 * Copyright 2010-2019 Tiny Technologies LLC. All rights reserved.
 *
 * Version: 2.2.0-97
 */

!function(){"use strict";function n(t){return parseInt(t,10)}function r(t,n){return 0==(n=t-n)?0:0<n?1:-1}function e(t,n,e){return{major:t,minor:n,patch:e}}function o(t){return(t=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(t))?e(n(t[1]),n(t[2]),n(t[3])):e(0,0,0)}function A(t,n){return!!t&&-1===function(t,n){var e=r(t.major,n.major);if(0!==e)return e;e=r(t.minor,n.minor);if(0!==e)return e;n=r(t.patch,n.patch);return 0!==n?n:0}(o([(t=t=t).majorVersion,t.minorVersion].join(".").split(".").slice(0,3).join(".")),o(n))}function i(t){return function(){return t}}var t=function(r,o){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=r.console;e&&o in e&&e[o].apply(e,arguments)}},u={log:t(window,"log"),error:t(window,"error"),warn:t(window,"warn")},c=i(!1),a=i(!0),t=function(){return l},l={fold:function(t,n){return t()},is:c,isSome:c,isNone:a,getOr:m,getOrThunk:f,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(void 0),or:m,orThunk:f,map:t,each:function(){},bind:t,exists:c,forall:a,filter:t,equals:s,equals_:s,toArray:function(){return[]},toString:i("none()")};function s(t){return t.isNone()}function f(t){return t()}function m(t){return t}function d(t){return!(null==t)}function P(t,n){return t.dom.is(n,M(t))}function p(t){console.error(t)}function E(t){return t&&"string"==typeof t.id&&"string"==typeof t.name}function C(t){E(t)||p("mentions_fetch didn't produce a valid list of users.")}function T(t,n){return(n=P(t,n))||p("mentions_complete needs to produce a element that matches selector: "+M(t)),n}function S(t){function n(){}function e(t,n){return"function"==typeof t?t:n}function r(t,n){var o,i=e(t,n);return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r={},e=t.map(function(t){var e;return"function"==typeof t&&(e=t,t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];r===o&&e.apply(null,t)}),t}),r=o={};i.apply(null,e)}}var o=r(t.getParam("mentions_menu_hover"),n),i=r(t.getParam("mentions_fetch"),function(t,n){n([])}),u=e(t.getParam("mentions_menu_complete"),function(t,n){var e=t.dom.create("span",{class:"mention"});return e.appendChild(t.dom.doc.createTextNode("@"+n.name)),e}),c=e(t.getParam("mentions_menu_cancel"),n);return{hover:o,fetch:i,complete:u,select:r(t.getParam("mentions_select"),n),cancel:c}}function N(e){e.on("SetContent",function(){var t,n;(t=e).$(M(t),n).prop("contentEditable","false")}),e.on("PreProcess",function(t){!function(t,n,e){n=t.$(M(t),n);n.removeAttr("contenteditable"),e||n.removeAttr(D)}(e,t.node,t.source_view)}),e.on("ResolveName",function(t){P(e,t.target)&&(t.name="mention")})}function v(t,n,e){var r=n.x,o=n.y,i=t.w,u=t.h,t=n.w,n=n.h;return"b"===(e=(e||"").split(""))[0]&&(o+=n),"r"===e[1]&&(r+=t),"c"===e[0]&&(o+=q(n/2)),"c"===e[1]&&(r+=q(t/2)),"b"===e[3]&&(o-=u),"r"===e[4]&&(r-=i),"c"===e[3]&&(o-=q(u/2)),"c"===e[4]&&(r-=q(i/2)),H(r,o,i,u)}function g(t,n,e){var r=U.getViewPort();return r.w-=30,r.h-=30,r=function(t,n,e,r){for(var o,i=0;i<r.length;i++)if((o=v(t,n,r[i])).x>=e.x&&o.x+o.w<=e.w+e.x&&o.y>=e.y&&o.y+o.h<=e.h+e.y)return r[i];return null}(t,n,r,e),t=v(t,n,r||e[0]||"bl-tl")}function k(t,n,e,r){e=e,t=I(t=t,t.dom.getRect(e)),e=U.getRect(n),e=g(e,t,r),U.setStyles(n,{position:"absolute",left:e.x,top:e.y})}function y(o,t,n,e){function i(t,n){var e=m(((r=(r=t.rng).cloneRange()).setStart(r.startContainer,r.startOffset+1),r)),r=g($.getRect(n.getEl()),(t=0,r=2,H((e=e).x-t,e.y-r,e.w+2*t,e.h+2*r)),["bl-tl","tl-bl","tl-br","bl-tr"]);n.moveTo(r.x,r.y)}function u(){s&&($.remove(s),s=null)}function c(){u(),l&&(l.remove(),l=null)}function r(){u(),l&&l.hide()}function a(n){e(n.settings.data,function(t){n.getEl().parentNode&&0!==l.items().length&&l.visible()&&($.setStyles(t,{position:"absolute",left:-65535,top:-65535}),$.add(document.body,t),function(t,n){n=g($.getRect(t),$.getRect(n),["tr-tl","tl-tr","bl-br","br-bl"]);$.setStyles(t,{left:n.x,top:n.y})}(t,n.getEl()),u(),s=t)})}var l,s,f=-1,m=function(t){var n=t.getClientRects()[0],t=o.inline?$.getViewPort():{x:0,y:0};return I(o,{x:n.left+t.x,y:n.top+t.y,w:n.width,h:n.height})},d=function(e){u(),l.items().each(function(t,n){t===e&&f!==n&&(e.hover(),a(e),f=n)})},p=function(){var t;r(),(t=l.items()[f])&&n(t.settings.data)};return{isVisible:function(){return null!==l&&l.visible()},selectNext:function(){d(l.items()[f+1])},selectPrev:function(){d(l.items()[f-1])},showAt:function(r){t(function(t){var n,e;0!==t.length?(l=(l||(l=tinymce.ui.Factory.create("menu",{onhide:function(){u()},classes:"contextmenu"}).renderTo(),o.on("remove",c),l)).show(),(n=l).getEl().style.width="",n.getEl("body").style.width="",l.items().remove(),l.add((t=t,e=r.text,F.map(t,function(t){return{text:t.fullName,data:t,match:e,onclick:function(){d(this),p()},onmouseenter:function(){d(this)}}}))),l.renderNew(),l.initLayoutRect(),i(r,l),f=-1,d(l.items()[0])):l&&l.hide()})},hide:r,complete:p}}function h(t){if(null===t)return null;var n=(r=t).collapsed&&3===r.startContainer.nodeType?r.startContainer:null;if(null===n)return null;var e=t.startOffset,r=function(t,n){for(var e=n-1;0<=e;e--){if(K.test(t.charAt(e)))return null;if("@"===t.charAt(e))break}return-1===e||n-e<2?null:t.substring(e+1,n)}(n.data,e);return null===r?null:((t=t.cloneRange()).setStart(n,e-r.length-1),t.setEnd(n,e),{text:r,rng:t})}function b(r){function o(){return h(r.selection.getRng())}function e(){var t;d(u)&&(t=u.parentNode,d(t)&&t.removeChild(u),u=null)}function i(){l.isVisible()&&a.cancel(),l.hide()}function n(t,n){t.preventDefault(),n()}var u,c={},a=S(r),l=y(r,function(n){var t=o();t&&(t={term:t.text},a.fetch(t,function(t){W.each(t,C);t=t.slice(0,10);n(W.grep(t,E))}))},function(t){var n,e=a.complete(r,t);T(r,e)&&(n=o(),e.contentEditable="false",e.setAttribute(D,t.id),c[t.id]=t,d(n)&&r.selection.setRng(n.rng),r.insertContent(e.outerHTML))},a.hover),s=function(){var t,n;r.removed||(t=o(),!!(n=t)&&1<=n.text.length?l.showAt(t):i())},t=function(t){if(l.isVisible()&&!B.modifierPressed(t))switch(t.keyCode){case 27:n(t,i);break;case B.UP:n(t,l.selectPrev);break;case B.DOWN:n(t,l.selectNext);break;case B.ENTER:case B.TAB:n(t,l.complete)}else i()},f=function(t){t.keyCode===B.BACKSPACE&&s(),t.keyCode!==B.LEFT&&t.keyCode!==B.RIGHT||i()},m=function(t){var n=t.element;P(r,n)&&!r.selection.isCollapsed()?a.select(n,function(t){t instanceof HTMLElement&&(e(),u=t,document.body.appendChild(t),k(r,t,n,["bl-tl","tl-bl","tl-br","bl-tr"]))}):e()};return N(r),r.on("keypress",V(s,100)),r.on("keydown",t),r.on("keyup",f),r.on("nodechange",m),r.on("remove",e),{getUsers:function(){var n=[],e=W.map(r.dom.select("["+D+"]"),function(t){return t.getAttribute(D)});return W.each(c,function(t){-1!==W.inArray(e,t.id)&&n.push(t)}),n}}}var x,w=function(e){function t(){return o}function n(t){return t(e)}var r=i(e),o={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:a,isNone:c,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:t,orThunk:t,map:function(t){return w(t(e))},each:function(t){t(e)},bind:n,exists:n,forall:n,filter:function(t){return t(e)?o:l},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(c,function(t){return n(e,t)})}};return o},j={some:w,none:t,from:function(t){return null==t?l:w(t)}},_=tinymce.util.Promise,t=function(n){return function(t){return typeof t===n}},O=(x="string",function(t){return t=typeof(n=t),(null===n?"null":"object"==t&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":t)===x;var n}),R=t("boolean"),L=t("number"),M=function(t){return t.getParam("mentions_selector",".mention","string")},D="data-mce-mentions-id",V=function(e,r){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];clearTimeout(o),o=setTimeout(function(){e.apply(this,t)},r)}var o;return t.stop=function(){clearTimeout(o)},t},q=Math.round,H=function(t,n,e,r){return{x:t,y:n,w:e,h:r}},U=tinymce.DOM,I=function(t,n){return t.inline||(t=U.getPos(t.getContentAreaContainer()),n.x+=t.x,n.y+=t.y),n},$=tinymce.DOM,F=tinymce.util.Tools,K=/[\u00a0 \t\r\n]/,W=tinymce.util.Tools,B=tinymce.util.VK,G=function(){return(G=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)};function z(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;for(var r=Array(t),o=0,n=0;n<e;n++)for(var i=arguments[n],u=0,c=i.length;u<c;u++,o++)r[o]=i[u];return r}function J(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var i=t[o];r[o]=n(i,o)}return r}function Q(t,n){return ut(t,n)?j.from(t[n]):j.none()}function X(t,n,e){!function(t,n,e){if(!(O(e)||R(e)||L(e)))throw console.error("Invalid call to Attribute.set. Key ",n,":: Value ",e,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(n,e+"")}(t.dom,n,e)}function Y(t,n){return function(t,n,e){e=function(t,n){n=function(t,n){n=t.dom.getAttribute(n);return null===n?void 0:n}(t,n);return void 0===n||""===n?[]:n.split(" ")}(t,n).concat([e]);return X(t,n,e.join(" ")),!0}(t,"class",n)}function Z(t,n){void 0!==t.dom.classList?t.dom.classList.add(n):Y(t,n)}function tt(t,n){t.dom.appendChild(n.dom)}function nt(t,n){t.dom.textContent=n}function et(t){return"profile"!==t.type?j.none():j.some(function(t){var e=at("div");Z(e,"tox"),Z(e,"tox-mentions__card"),j.from(t.image).each(function(t){var n=at("img");X(n,"src",t),Z(n,"tox-mentions__avatar"),tt(e,n)});var r=at("div");Z(r,"tox-mentions__container"),tt(e,r);var n=at("div");return Z(n,"tox-mentions__username"),nt(n,t.name),tt(r,n),j.from(t.description).map(function(t){var n=at("div");Z(n,"tox-mentions__description"),nt(n,t),tt(r,n)}),e}(t.user))}function rt(i,t){function r(){null!==y&&null!==y.parentNode&&(y.removeEventListener("mouseover",w),y.removeEventListener("mouseout",_),y.parentNode.removeChild(y)),y=null}function n(n){function e(t){r(),(y=t).addEventListener("mouseover",w),y.addEventListener("mouseout",_),y.style.position="absolute",y.style.left="-10000px",y.style.top="-10000px",document.body.appendChild(y),k(i,y,n,["bl-tl","tl-bl","tl-br","bl-tr"])}g.select(n,function(t){t instanceof HTMLElement?e(t):et(t).each(function(t){return e(t.dom)})})}function e(){r()}function o(t){return lt.clearTimeout(t)}function u(t){o(d),o(p),d=lt.setEditorTimeout(i,function(){return n(t)},0)}function c(){return h.isSet()||P(i,i.selection.getNode())&&!i.selection.isCollapsed()}function a(t){0<(t=i.dom.$(t.target).closest(M(i))).length&&(h.set(!0),u(t[0]))}function l(t){0<i.dom.$(t.target).closest(M(i)).length&&(h.clear(),c()||e())}function s(t){P(i,t.element)&&!i.selection.isCollapsed()?u(t.element):c()||_()}var f,m,d,p,v={},g=S(i),y=null,h=(x=j.none(),f=x,m={get:function(){return f},set:function(t){f=t}},{clear:function(){return m.set(j.none())},set:function(t){return m.set(j.some(t))},isSet:function(){return m.get().isSome()},on:function(t){return m.get().each(t)}}),b=i.getParam("mentions_min_chars",1,"number"),x=i.getParam("mentions_item_type","name","string"),w=function(){o(p)},_=function(){o(p),o(d),p=lt.setEditorTimeout(i,e,300)},O=A(tinymce,"5.6.0")||"name"===x?function(t,n){return{type:"autocompleteitem",value:t.id,text:t.name,meta:{user:t,tooltipWorker:n}}}:function(n,t){var e=Q(n,"image").map(function(t){return{type:"cardimage",src:t,classes:["tox-mentions__avatar"],alt:n.name}}).toArray(),r=Q(n,"description").map(function(t){return{type:"cardtext",text:t,classes:["tox-mentions__description"]}}).toArray();return{type:"cardmenuitem",value:n.id,label:n.name,items:z(e,[{type:"cardcontainer",direction:"vertical",items:z([{type:"cardtext",text:n.name,name:"username",classes:["tox-mentions__username"]}],r)}]),meta:{user:n,tooltipWorker:t}}};return i.ui.registry.addAutocompleter("mentions",{ch:"@",minChars:b,maxResults:10,highlightOn:["username"],onAction:function(t,n,e,r){var o;Q(r,"reload").is(!0)?(r.reload,o=function(t,n){var e={};for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&n.indexOf(o)<0&&(e[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(t);r<o.length;r++)n.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(e[o[r]]=t[o[r]]);return e}(r,["reload"]),t.reload(o)):(o=r.user,r=n,n=g.complete(i,o),T(i,n)&&(n.contentEditable="false",n.setAttribute(D,o.id),v[o.id]=o,i.selection.setRng(r),i.insertContent(n.outerHTML)),t.hide())},fetch:function(i,u,c){return new ft(function(e){var t,r,n,o;t=i,r=u,n=c,o=function(t,n){e(function(t,n){void 0===n&&(n=[]);t=J(t,function(n){return O(n,function(t){g.hover(n,t)})});if(A(tinymce,"5.0.14"))return t;n=J(n,function(t){return{value:void 0===t.value?"":t.value,text:t.text,meta:G(G({},t.meta),{reload:!0})}});return z(t,0<n.length?[{type:"separator"}]:[],n)}(t,n))},g.fetch({term:t,meta:n},function(t,n){st.each(t,C);t=t.slice(0,r);o(st.grep(t,E),n)})})},columns:1}),N(i),i.on("mouseover",a),i.on("mouseout",l),i.on("nodechange",s),i.on("remove",r),{getUsers:function(){var n=[],e=st.map(i.dom.select("["+D+"]"),function(t){return t.getAttribute(D)});return st.each(v,function(t){-1!==st.inArray(e,t.id)&&n.push(t)}),n}}}function ot(t,n){return A(tinymce,"4.3.13")?(u.error("The mentions plugin requires at least 4.3.13 version of TinyMCE."),function(){}):A(tinymce,"5.0.0")?b(t):(t.on("init",function(){var o,i;o=t,i=n,new _(function(t,n){var e=o.getParam("mentions_css_url"),r=e?e+"/":i+"/css/";j.from(null===(e=o.ui)||void 0===e?void 0:e.styleSheetLoader).getOr(tinymce.DOM.styleSheetLoader).load(r+"mentions.css",t,n)})}),rt(t))}var it=Object.hasOwnProperty,ut=function(t,n){return it.call(t,n)},ct=("undefined"!=typeof window||Function("return this;")(),function(t){if(null==t)throw new Error("Node cannot be null or undefined");return{dom:t}}),at=function(t,n){t=(n||document).createElement(t);return ct(t)},lt=tinymce.util.Delay,st=tinymce.util.Tools,ft=tinymce.util.Promise;tinymce.PluginManager.add("mentions",ot)}();